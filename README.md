# Простое приложение на андроид

Приложение состоит из трех небольших приложений. Каждое работает независимо друг от друга и имеет свою иконку для перехода к нему (на главном экране приложения)

[![photo-5249237801889820116-y.jpg](https://i.postimg.cc/0yHR9DXw/photo-5249237801889820116-y.jpg)](https://postimg.cc/LJf0TYp9)

1. **Калькулятор** 
   
**Описание:** 

- Самый простой калькулятор без сложного парсера, поэтому производить вычисления более чем с двумя операндами нельзя. Скобки тоже не обрабатываются.
Имеет 2 текстовых поля: одно для текущего выражения, другое для предыдущего.
- Намбар реализован с помощью TableLayout, который позволяет выравнивать объекты по сетке.
- Сторонние библиотеки не использовались 
- Разрешения не требуются

**Идеи по улучшению:** 

- Написать парсер самому или использовать готовое решение 
- Сделать горизонтальный активити и расширить функционал калькулятора до инженерного 
- Сделать более креативный дизайн

[![photo-5246986002076136693-y.jpg](https://i.postimg.cc/QCjxcjqZ/photo-5246986002076136693-y.jpg)](https://postimg.cc/34bTT56t)

2. **Аудиоплеер**

**Описание:** 

- Достаточно простой плеер с небольшим функционалом. Имеет кнопку старт/стоп, 2 кнопки для включения следующей/предыдущей песни, seekbar, показывающий текущее состояние песни и позволяющий перематывать ее,
обновляется по таймеру и высчитывается в зависимости от текущей позиции песни
- Музыка берется из определенной директории (телефон не сканируется для поиска музыки)
- Реализован на основе встроенного класса **MediaPlayer**. Сторонние решения не использовались
- Под плеером есть ScrollView со всеми песнями, которые находятся в директории
- Необходимо разрешение на чтение из внешнего хранилища (READ_EXTERNAL_STORAGE)

**Идеи по улучшению:** 

- Добавить возможность для перемотки песни на 5-10 секунд вперед/назад, добавить тип воспроизведения (без повтора, с повтором, по порядку, в рандомном порядке)
- Декодировать обложку из аудиофайла и выводить ее на экран 
- Сделать более продвинутую систему поиска музыки на телефоне 
- Спрятать список музыки, а чтобы получить к нему доступ нужно сделать свайп (шторка) 
- Названия песен в списке музыки сделать кнопками, при нажатии на которые будет воспроизводиться песня с этим названием
- Для фонового режима в поле для уведомлений вывести небольшой функционал (пауза/стоп, перемотка песни, включить следующую/предыдущую песню)

[![photo-5249237801889820108-y.jpg](https://i.postimg.cc/5yVPS2yg/photo-5249237801889820108-y.jpg)](https://postimg.cc/wywc6HhR)

3. **GPS tracker с анализом качества мобильной связи**

**Описание:** 

- Приложение получает данные о геолокации пользователя, отслеживает его путь и наносит его на карту в виде ломанной линии. Одновременно с этим приложение получает данные о качестве мобильной связи и на их основе
окрашивает звенья ломанной в определенные цвета. Помимо всего это приложение пишет все данные в файл в JSON формате

- Для получения данных о геолокации пользователя использовалось стороннее решение от **Google ("com.google.android.gms:play-services-location:21.2.0")**, с помощью него можно получить следующие данные:

   Latitude(lat) - широта \
   Longitude(lon) - долгота \
   Altitude(alt) - высота над уровнем моря \
   Accuracy(acc) - точность (в метрах) \
   Speed(spd) - скорость (м/с) \
   Time - время от 1 января 1970 года в мс 

- Для получения данных о качестве мобильной связи используется встроенный класс **TelephonyManager**. С помощью него можно получить следующие данные:

   **Signal level(SignalLvl):**
   
   4 - Great (Green) \
   3 - Good (Yellow) \
   2 - No good (Orange) \
   1 - Bad (Red) \
   0 - No signal (Black)

   **Signal type(SignalType)**
   
   0	- Не удалось определить тип сети \
   1	- 2G GPRS (до 114 Кбит/с) \
   2	-	2G EDGE/EGPRS (до 384 Кбит/с) \
   3	- 3G UMTS (до 2 Мбит/с) \
   4	- 2G CDMA (IS-95) \
   5	- 3G EV-DO Rev. 0 (до 2.4 Мбит/с) \
   6	- 3G EV-DO Rev. A (до 3.1 Мбит/с) \
   7	- 2G 1xRTT (до 144 Кбит/с) \
   8	- 3G HSDPA (до 14.4 Мбит/с) \
   9	- 3G HSUPA (до 5.76 Мбит/с) \
   10 - 3G	HSPA (HSDPA+HSUPA, до 21 Мбит/с) \
   11 - 2G iDEN (устаревший) \
   12 - 3G	EV-DO Rev. B (до 14.7 Мбит/с) \
   13 - 4G	LTE (до 100 Мбит/с) \
   14 - 3G	eHRPD (эволюционный HRPD) \
   15 - 3G	HSPA+ (до 42 Мбит/с) \
   16 - 2G	GSM (устаревший) \
   17 - 3G	TD-SCDMA (Китай) \
   18 - Wi-Fi	IEEE 802.11 \
   19 - LTE Carrier Aggregation \
   20 - 5G	New Radio (5G)

- Все полученные данные выводятся на экран с постоянным обновлением. Также выводится табличка с соотношением уровень сигнала - цвет

- Для реализации карты использовалось API от Yandex **MapKit ("com.yandex.android:maps.mobile:4.14.0-full")**. Для использования необходимо получить API ключ и зарегистрировать его в программе.
API помимо самой карты имеет много встроенных методов, в том числе методы для отображения маркеров или ломанных на карте. Есть возможность делать кастомные маркеры или ломанные

- Для записи/чтения полученных данных в файл в JSON формате используется готове решение от Google **Gson("com.google.code.gson:gson:2.10.1")**. Запись происходит с помощью классов,
т.е создается объект класса, он проходит через встроенный сериализатор, приводится к строке и потом записывается в файл в формате JSON. Простое, удобное и безопасное решение

- Требуются следующие разрешения:

   ACCESS_COARSE_LOCATION - доступ к неточному местоположению \
   ACCESS_FINE_LOCATION - доступ к точному местоположению \
   WRITE_EXTERNAL_STORAGE -запись во внешнее хранилище \
   READ_PHONE_STATE - получение данных о состоянии телефона (в том числе и о качестве связи)

**Идеи по улучшению:** 

- Поработать с точностью GPS, добиться меньших GPS колебаний (особенно в помещениях) 
- Добавить отдельный анализатор файлов (т.е загружаем файл, а на карте отображается путь) 
- Добавить плавный переход между звеньями разных цветов (градиент) 
- Добавить ForegroundService для получения локации в фоновом режиме ✔️
- Добавить историю перемещений, чтобы можно было аналзировать не только текущий маршрут, но и предыдущие

[![photo-5246986002076136694-y.jpg](https://i.postimg.cc/7LkT6rT0/photo-5246986002076136694-y.jpg)](https://postimg.cc/G4Xp7NKm)

# Обновления

**Новая ветка service:**

- Добавлен Foreground Service для получения location пользователя в фоновом режиме. Теперь логика получения location 
реализована в отдельном файле LocationService.kt. Это делает код более структурированным и читаемым. К сожалению, по каким то причинам
сервис получает location значительно медленее, чем если бы location получался в активити напрямую. Это может быть связано с желанием
телефона сэкономить заряд на фоновых задачах или же из-за очень медленной передачи данных от сервиса к активити. Обновление с сервисом
вынесено в отдельную ветку, т.к требует доработок. На данный момент лучше использовать программу из главной ветки.

**Решение проблемы:**

- Проблема заключалась в том, что не было получено разрешение **PERMISSION_REQUEST_BACKGROUND_LOCATION**, которое снимает ограничения на получение локации в фоновом режиме (подробнее можно прочиать [здесь](https://developer.android.com/about/versions/oreo/background-location-limits?hl=ru)). Помимо этого оказалось, что это разрешение относится к особому типу разрешений и получить его можно только если ранее было получено одно из разрешений **ACCESS_COARSE_LOCATION** или **ACCESS_FINE_LOCATION**, поэтому запрос данного разрешения отличается от запроса других из-за чего потребовалось изменить код для получения разрешений

  **Новая ветка balance:**

- Была добавлена новая версия GPS tracker, которая объединяет в себе два предыдущих. Сервис для получения локации используется только при надобности, т.е когда приложение переходит в фоновый режим работты. При стандартной работе приложения данные о локации поступают из активити. Переход между двумя способами получения локации занимает пару секунд. Этот способ работы избавляет пользователя от постоянного уведомления о работе foreground сервиса, а также от лишнего расхода батареи (сервисы потребляют больше заряда).

**Изменение структуры веток**

- Ветка balance перешла в main, а ветка master в without_service. Это связано с тем, что balance ветка стала наиболее стабильной версией приложения, поэтому она стала дефолтной.
  
**Создание сервера и работа с сокетами**

- Добавлен submodule Android_backend, содержащий простой сервер на Python, который через сокеты принимает от Kotlin данные о местоположении пользователя и о качестве мобильной связи.
